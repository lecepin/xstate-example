{"version":3,"sources":["mock.js","fsm.js","App.js","index.js"],"names":["createServer","routes","this","namespace","post","_","req","console","log","requestBody","Math","random","success","errorMsg","timing","passthrough","url","indexOf","feddbackMachine","createMachine","id","initial","context","score","selectModule","suggest","states","不显示","onEntry","on","打开","target","显示","步骤记录","评分","onExit","值改变","actions","下一步","cond","关注功能","上一步","不满意","满意","上个步骤","type","history","建议","提交","提交中","invoke","src","onDone","onError","结束","after","关闭","guards","isLess","ctx","isMore","isEqual","doScoreChange","assign","e","value","doSelectChange","doSuggestChange","doNoScore","doSubmitFail","data","doClearErrorMsg","doInitContext","services","serviceSubmit","fetch","method","body","JSON","stringify","then","json","Promise","reject","App","useMachine","devTools","state","send","className","matches","size","onClick","visible","title","footer","onCancel","mask","wrapClassName","Paragraph","Text","onChange","Group","options","label","TextArea","placeholder","tip","some","style","marginRight","inspect","iframe","document","getElementById","Split","minSize","sizes","ReactDOM","render"],"mappings":"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","file":"static/js/main.df9c854e.chunk.js","sourcesContent":["import { createServer } from \"miragejs\";\n\ncreateServer({\n  routes() {\n    this.namespace = \"api\";\n\n    this.post(\n      \"/submit\",\n      (_, req) => {\n        console.log(req.requestBody);\n\n        if (Math.random() < 0.5) {\n          return {\n            success: false,\n            errorMsg: \"提交失败，请重试\",\n          };\n        }\n\n        return {\n          success: true,\n        };\n      },\n      { timing: 1000 }\n    );\n\n    this.passthrough((req) => {\n      return req.url.indexOf(this.namespace) == -1;\n    });\n  },\n});\n","import { createMachine, actions } from \"xstate\";\n\nconst feddbackMachine = createMachine(\n  {\n    id: \"反馈建议\",\n    initial: \"不显示\",\n    context: {\n      score: 0,\n      selectModule: [],\n      suggest: \"\",\n      errorMsg: \"\",\n    },\n    states: {\n      不显示: {\n        onEntry: \"doInitContext\",\n        on: {\n          打开: {\n            target: \"#反馈建议.显示\",\n          },\n        },\n      },\n      显示: {\n        initial: \"步骤记录\",\n        states: {\n          步骤记录: {\n            initial: \"评分\",\n            states: {\n              评分: {\n                onExit: \"doClearErrorMsg\",\n                on: {\n                  值改变: {\n                    actions: \"doScoreChange\",\n                  },\n                  下一步: [\n                    {\n                      cond: \"isLess\",\n                      target: \"#反馈建议.显示.步骤记录.关注功能.不满意\",\n                    },\n                    {\n                      cond: \"isMore\",\n                      target: \"#反馈建议.显示.步骤记录.关注功能.满意\",\n                    },\n                    {\n                      cond: \"isEqual\",\n                      target: \"#反馈建议.显示.建议\",\n                    },\n                    { actions: \"doNoScore\" },\n                  ],\n                },\n              },\n\n              关注功能: {\n                on: {\n                  上一步: {\n                    target: \"#反馈建议.显示.步骤记录.评分\",\n                  },\n                  下一步: {\n                    target: \"#反馈建议.显示.建议\",\n                  },\n                  值改变: {\n                    actions: \"doSelectChange\",\n                  },\n                },\n                states: {\n                  不满意: {},\n                  满意: {},\n                },\n              },\n              上个步骤: {\n                type: \"history\",\n                history: \"deep\",\n              },\n            },\n          },\n          建议: {\n            onExit: \"doClearErrorMsg\",\n            on: {\n              上一步: {\n                target: \"#反馈建议.显示.步骤记录.上个步骤\",\n              },\n              提交: {\n                target: \"#反馈建议.显示.提交中\",\n              },\n              值改变: {\n                actions: \"doSuggestChange\",\n              },\n            },\n          },\n          提交中: {\n            invoke: {\n              id: \"serviceSubmit\",\n              src: \"serviceSubmit\",\n              onDone: {\n                target: \"#反馈建议.显示.结束\",\n              },\n              onError: {\n                target: \"#反馈建议.显示.建议\",\n                actions: \"doSubmitFail\",\n              },\n            },\n          },\n          结束: {\n            after: {\n              2000: {\n                target: \"#反馈建议.不显示\",\n              },\n            },\n          },\n        },\n        on: {\n          关闭: {\n            target: \"#反馈建议.不显示\",\n          },\n        },\n      },\n    },\n  },\n  {\n    guards: {\n      isLess: (ctx) => ctx.score < 3 && ctx.score > 0,\n      isMore: (ctx) => ctx.score > 3,\n      isEqual: (ctx) => ctx.score == 3,\n    },\n    actions: {\n      doScoreChange: actions.assign({\n        score: (ctx, e) => e.value,\n      }),\n      doSelectChange: actions.assign({\n        selectModule: (ctx, e) => e.value,\n      }),\n      doSuggestChange: actions.assign({\n        suggest: (ctx, e) => e.value,\n      }),\n      doNoScore: actions.assign({\n        errorMsg: \"请完成此项评价\",\n      }),\n      doSubmitFail: actions.assign({\n        errorMsg: (ctx, e) => e.data,\n      }),\n      doClearErrorMsg: actions.assign({\n        errorMsg: \"\",\n      }),\n      doInitContext: actions.assign({\n        score: 0,\n        selectModule: [],\n        suggest: \"\",\n        errorMsg: \"\",\n      }),\n    },\n    services: {\n      serviceSubmit: ({ score, selectModule, suggest }) =>\n        fetch(\"/api/submit\", {\n          method: \"POST\",\n          body: JSON.stringify({ score, selectModule, suggest }),\n        })\n          .then((data) => data.json())\n          .then((data) => {\n            if (!data.success) {\n              return Promise.reject(data.errorMsg);\n            }\n          }),\n    },\n  }\n);\n\nexport { feddbackMachine };\n","import { useMachine } from \"@xstate/react\";\nimport {\n  Modal,\n  Button,\n  Typography,\n  Rate,\n  Checkbox,\n  Input,\n  Spin,\n  Divider,\n  Avatar,\n} from \"antd\";\nimport { feddbackMachine } from \"./fsm\";\n\nimport \"./styles.css\";\n\nexport default function App() {\n  const [state, send] = useMachine(feddbackMachine, { devTools: true });\n  const { score, errorMsg, selectModule, suggest } = state.context;\n\n  return (\n    <div className=\"App\">\n      {state.matches(\"不显示\") ? (\n        <Avatar\n          className=\"App-feedback-btn\"\n          size={50}\n          onClick={() => send(\"打开\")}\n        >\n          反馈\n        </Avatar>\n      ) : null}\n\n      <Modal\n        visible={state.matches(\"显示\")}\n        title=\"反馈与建议\"\n        footer={false}\n        onCancel={() => send(\"关闭\")}\n        mask={false}\n        className=\"App-feedback-modal\"\n        wrapClassName=\"App-feedback-modal-wrap\"\n      >\n        {state.matches(\"显示.步骤记录.评分\") ? (\n          <>\n            <Typography.Paragraph>你对此系统是否满意？</Typography.Paragraph>\n            <Typography.Text type=\"secondary\">不满意</Typography.Text>\n            <Rate\n              value={score}\n              onChange={(value) => send(\"值改变\", { value })}\n            />\n            <Typography.Text type=\"secondary\">十分满意</Typography.Text>\n          </>\n        ) : null}\n\n        {state.matches(\"显示.步骤记录.关注功能.不满意\") ? (\n          <Typography.Paragraph>你最不满意的有哪些功能？</Typography.Paragraph>\n        ) : null}\n\n        {state.matches(\"显示.步骤记录.关注功能.满意\") ? (\n          <Typography.Paragraph>你最满意的有哪些功能？</Typography.Paragraph>\n        ) : null}\n\n        {state.matches(\"显示.步骤记录.关注功能\") ? (\n          <Checkbox.Group\n            value={selectModule}\n            options={[\n              {\n                label: \"功能A\",\n                value: \"A\",\n              },\n              {\n                label: \"功能B\",\n                value: \"B\",\n              },\n              {\n                label: \"功能C\",\n                value: \"C\",\n              },\n              {\n                label: \"功能D\",\n                value: \"D\",\n              },\n              {\n                label: \"功能E\",\n                value: \"E\",\n              },\n            ]}\n            onChange={(value) => send(\"值改变\", { value })}\n          />\n        ) : null}\n\n        {state.matches(\"显示.建议\") ? (\n          <>\n            <Typography.Paragraph>您是否有其他建议？</Typography.Paragraph>\n            <Input.TextArea\n              placeholder=\"请输入\"\n              value={suggest}\n              onChange={(e) => send(\"值改变\", { value: e.target.value })}\n            ></Input.TextArea>\n          </>\n        ) : null}\n\n        {state.matches(\"显示.提交中\") ? (\n          <div className=\"App-center\">\n            <Spin size=\"large\" tip=\"提交中…\" />\n          </div>\n        ) : null}\n\n        {state.matches(\"显示.结束\") ? (\n          <div className=\"App-center\">\n            <img src=\"./bixin.png\" />\n            <Typography.Paragraph type=\"secondary\">\n              感谢您的反馈，2秒后自动关闭窗口{\" \"}\n            </Typography.Paragraph>\n          </div>\n        ) : null}\n\n        {errorMsg ? (\n          <Typography.Paragraph type=\"danger\">{errorMsg}</Typography.Paragraph>\n        ) : null}\n\n        <Divider />\n\n        <div className=\"App-feedback-modal-footer\">\n          {[\"显示.建议\", \"显示.步骤记录.关注功能\"].some(state.matches) ? (\n            <Button style={{ marginRight: 12 }} onClick={() => send(\"上一步\")}>\n              上一步\n            </Button>\n          ) : null}\n\n          {state.matches(\"显示.步骤记录\") ? (\n            <Button onClick={() => send(\"下一步\")}>下一步</Button>\n          ) : null}\n\n          {state.matches(\"显示.建议\") ? (\n            <Button type=\"primary\" onClick={() => send(\"提交\")}>\n              提交\n            </Button>\n          ) : null}\n        </div>\n      </Modal>\n    </div>\n  );\n}\n","import { StrictMode } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport Split from \"split.js\";\nimport { inspect } from \"@xstate/inspect\";\nimport \"./mock\";\nimport App from \"./App\";\n\nimport \"./index.css\";\n\ninspect({\n  iframe: document.getElementById(\"xstate-inspect\"),\n  url: \"https://apis.leping.fun/viz?inspect&panel=false\",\n});\n\nSplit([\"#xstate-inspect\", \"#root\"], { minSize: 0, sizes: [50, 50] });\n\nReactDOM.render(\n  <StrictMode>\n    <App />\n  </StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}